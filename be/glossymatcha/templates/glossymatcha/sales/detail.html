{% extends 'glossymatcha/base.html' %}
{% load money_filters %}

{% block title %}{{ sale.year }}년 {{ sale.month }}월 매출 상세 - Glossy Matcha{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h2 class="mb-0">
            <i class="bi bi-calculator me-2"></i>{{ sale.year }}년 {{ sale.month }}월 매출
            <span class="badge {% if sale.gross_profit >= 0 %}bg-success{% else %}bg-danger{% endif %} ms-2">
                {% if sale.gross_profit >= 0 %}이익{% else %}손실{% endif %}
            </span>
        </h2>
        <p class="text-muted">등록일: {{ sale.created_at|date:"Y.m.d H:i" }} · 수정일: {{ sale.updated_at|date:"Y.m.d H:i" }}</p>
    </div>
    <div class="col-md-4 text-end">
        <a href="{% url 'sales_update' sale.pk %}" class="btn btn-primary">
            <i class="bi bi-pencil me-2"></i>수정
        </a>
        <a href="{% url 'sales_delete' sale.pk %}" class="btn" style="background-color: #373735; color: #f2efe8; border: none;">
            <i class="bi bi-trash me-2"></i>삭제
        </a>
        <a href="{% url 'sales_list' %}" class="btn btn-outline-secondary">
            <i class="bi bi-list me-2"></i>목록
        </a>
    </div>
</div>

<div class="row">
    <!-- 매출 정보 -->
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0 text-primary"><i class="bi bi-graph-up me-2"></i>매출</h5>
            </div>
            <div class="card-body">
                <table class="table table-borderless">
                    <tr>
                        <td class="text-muted" width="50%">오프라인 매출</td>
                        <td class="text-end"><strong>{{ sale.offline_sales|korean_won_with_unit }}</strong></td>
                    </tr>
                    <tr>
                        <td class="text-muted">기타 매출</td>
                        <td class="text-end"><strong>{{ sale.other_sales|korean_won_with_unit }}</strong></td>
                    </tr>
                    <tr class="border-top">
                        <td class="text-muted"><strong>소계</strong></td>
                        <td class="text-end"><strong class="text-primary">{{ sale.total_sales|korean_won_with_unit }}</strong></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    
    <!-- 매출원가 정보 -->
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0 text-warning"><i class="bi bi-graph-down me-2"></i>매출원가</h5>
            </div>
            <div class="card-body">
                <table class="table table-borderless">
                    <tr>
                        <td class="text-muted" width="50%">재료비</td>
                        <td class="text-end"><strong>{{ sale.material_cost|korean_won_with_unit }}</strong></td>
                    </tr>
                    <tr>
                        <td class="text-muted">노무비</td>
                        <td class="text-end"><strong>{{ sale.labor_cost|korean_won_with_unit }}</strong></td>
                    </tr>
                    <tr>
                        <td class="text-muted">경비-소모품</td>
                        <td class="text-end"><strong>{{ sale.supplies_expense|korean_won_with_unit }}</strong></td>
                    </tr>
                    <tr>
                        <td class="text-muted">경비-기타</td>
                        <td class="text-end"><strong>{{ sale.other_expense|korean_won_with_unit }}</strong></td>
                    </tr>
                    <tr class="border-top">
                        <td class="text-muted"><strong>소계</strong></td>
                        <td class="text-end"><strong class="text-warning">{{ sale.total_cost|korean_won_with_unit }}</strong></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    
    <!-- 이익 및 기타 정보 -->
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0 text-success"><i class="bi bi-trophy me-2"></i>수익성</h5>
            </div>
            <div class="card-body">
                <table class="table table-borderless">
                    <tr>
                        <td class="text-muted" width="50%">1차 매출이익</td>
                        <td class="text-end">
                            <strong class="{% if sale.gross_profit >= 0 %}text-success{% else %}text-danger{% endif %}">
                                {{ sale.gross_profit|korean_won_with_unit }}
                            </strong>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-muted">재고금액</td>
                        <td class="text-end"><strong>{{ sale.inventory_amount|korean_won_with_unit }}</strong></td>
                    </tr>
                    <tr>
                        <td class="text-muted">실 사용금액</td>
                        <td class="text-end"><strong>{{ sale.actual_usage_amount|korean_won_with_unit }}</strong></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- 메모 -->
{% if sale.memo %}
<div class="card">
    <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-chat-text me-2"></i>메모</h5>
    </div>
    <div class="card-body">
        <p class="mb-0">{{ sale.memo|linebreaks }}</p>
    </div>
</div>
{% endif %}
{% endblock %}